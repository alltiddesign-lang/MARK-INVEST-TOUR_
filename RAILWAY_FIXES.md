# Исправление проблем на Railway

## Проблемы и решения

### 1. Ошибки 403 (Forbidden) - Токен авторизации недействителен

**Проблема:** При попытке сохранить тур или загрузить данные появляется ошибка 403.

**Решение:**
- Токен авторизации истек или недействителен
- При ошибке 403/401 админ-панель автоматически перенаправит на страницу входа
- Войдите заново через `/admin/login.html`

**Что было исправлено:**
- Добавлена обработка ошибок 403/401 во всех API запросах
- При ошибке авторизации токен удаляется из localStorage
- Автоматическое перенаправление на страницу входа

### 2. Ошибки 404 для изображений

**Проблема:** Изображения не загружаются, появляются ошибки 404.

**Причины на Railway:**
- Railway использует эфемерную файловую систему
- Файлы удаляются при перезапуске контейнера
- Папка `assets/images/` может не существовать

**Что было исправлено:**
- Добавлено автоматическое создание папки `assets/images/` при старте сервера
- Папка создается при каждой загрузке файла, если её нет

**Важно для Railway:**
Для постоянного хранения файлов на Railway рекомендуется:

1. **Использовать Railway Volumes** (рекомендуется):
   ```bash
   # В Railway Dashboard:
   # Settings -> Volumes -> Create Volume
   # Mount path: /app/assets/images
   ```

2. **Использовать внешнее хранилище** (S3, Cloudinary):
   - Настройте переменные окружения для S3 или Cloudinary
   - Измените код загрузки для сохранения в облако

### 3. Ошибка сохранения тура

**Проблема:** При попытке сохранить тур появляется ошибка.

**Что было исправлено:**
- Улучшена обработка ошибок - теперь показывается детальное сообщение
- Добавлена проверка статуса ответа (403/401) с перенаправлением на логин
- Улучшено логирование ошибок в консоль

**Как проверить:**
1. Откройте консоль браузера (F12)
2. Попробуйте сохранить тур
3. Проверьте детали ошибки в консоли

### 4. JavaScript SyntaxError

**Проблема:** "Uncaught SyntaxError: Unexpected identifier 'http'"

**Причина:** Возможно, проблема с динамической загрузкой скриптов или инъекцией кода.

**Решение:**
- Проверьте, что все скрипты загружаются правильно
- Убедитесь, что нет конфликтов с другими библиотеками
- Проверьте консоль на наличие других ошибок

## Инструкции по развертыванию на Railway

### 1. Настройка переменных окружения

В Railway Dashboard добавьте:
```
NODE_ENV=production
PORT=3000
JWT_SECRET=your-secret-key-here
CORS_ORIGIN=*
```

### 2. Настройка Volumes для хранения изображений

1. В Railway Dashboard перейдите в Settings вашего сервиса
2. Откройте раздел "Volumes"
3. Создайте новый Volume
4. Установите Mount Path: `/app/assets/images`
5. Перезапустите сервис

### 3. Проверка работы

После развертывания:
1. Откройте `/admin/login.html`
2. Войдите в систему
3. Попробуйте создать/редактировать тур
4. Проверьте, что изображения сохраняются и отображаются

## Дополнительные рекомендации

### Для production рекомендуется:

1. **Использовать Cloudinary или S3** для хранения изображений:
   - Изображения будут доступны даже после перезапуска
   - Лучшая производительность
   - CDN для быстрой загрузки

2. **Настроить мониторинг**:
   - Добавить логирование ошибок
   - Настроить алерты при ошибках

3. **Оптимизировать изображения**:
   - Использовать WebP формат
   - Сжимать изображения перед загрузкой

## Контакты для поддержки

Если проблемы не решены:
1. Проверьте логи Railway
2. Проверьте консоль браузера (F12)
3. Убедитесь, что все переменные окружения настроены правильно

